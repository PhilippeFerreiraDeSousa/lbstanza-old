defpackage test-multi :
  import core
  import collections

deftype A
deftype B <: A
deftype C <: A
deftype D <: B&C

defn A () : new A
defn B () : new B
defn C () : new C
defn D () : new D

defmulti f (x:A, y:A) -> False

defmethod f (a:A, b:A) : println("f A A")
defmethod f (a:A, b:C) : println("f A C")
defmethod f (a:C, b:A) : println("f C A")
defmethod f (a:D, b:D) : println("f D D")

defn A2 () :
  new A :
    defmethod f (this, b:B) :
      println("f A2 B")
    defmethod f (this, b:C) :
      println("f A2 C")

let : ;deftest multi-instance-method :
  ;f(A(), A())
  ;f(A(), C())
  ;f(C(), A())
  ;f(D(), D())
  ;f(D(), A())
  ;f(A(), D())
  f(A2(), A())
  f(A2(), B())
  f(A2(), C())
  f(A2(), D())
  
