defpackage stz/test-fastio-to-codegen-ir :
  import core
  import collections
  import stz/fastio-serializer-lang-parser
  import stz/fastio-code-transforms
  import stz/fastio-to-codegen-ir

;DEBUGGING
within (package,sig) = set-stack-trace-filter() :
  package != `core
  
defn main () :
  val filename = command-line-arguments()[1]
  val forms = reader/read-file(filename)
  val parsed = parse-syntax[fastio-serializer-lang / #defserializer](forms)
  val transformed = lift-combinators(parsed)
  val code-ir = to-codegen-ir(transformed)
  println(code-ir)

set-command-line-arguments(["parse" "testdata/serializer-lang-ir.txt"])
main()